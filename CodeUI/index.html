<!DOCTYPE html>
<html class="dark">
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	
	<!-- web app settings -->
	<!--
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="mobile-web-app-capable" content="yes">
	-->
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0">
	
	<!-- Title, icons and colors -->
	<title>S.E.P.I.A. Code UI</title>
	<meta name="application-name" content="S.E.P.I.A. Code UI"/>
	<meta name="apple-mobile-web-app-title" content="S.E.P.I.A. Code UI">
	<meta name="description" content="Code editor for the S.E.P.I.A.-Framework to create custom smart services.">
	<meta name="theme-color" content="#000">
	<!-- Icons -->
	<link rel="icon" sizes="192x192" href="img/icon-w.png">
	<link rel="apple-touch-icon" href="img/icon-w.png">
	
	<!-- open graph settings -->
	<meta property="og:title" content="S.E.P.I.A. Code UI"/>
	<meta property="og:determiner" content="the" />
	<meta property="og:url" content="https://sepia-framework.github.io/tools/"/>
	<meta property="og:description" content="Code editor for the S.E.P.I.A.-Framework to create custom smart services.">
	<meta property="og:image" content="https://sepia-framework.github.io/img/logo-w.png"/>
	<meta property="og:image:width" content="960"/>
	<meta property="og:image:height" content="960"/>
	<meta property="og:image:type" content="image/png"/>
	<meta property="og:image:alt" content="SEPIA Logo"/>
	<meta property="og:image" content="https://sepia-framework.github.io/tools/img/icon-w.png"/>
	<meta property="og:image:width" content="192"/>
	<meta property="og:image:height" content="192"/>
	<meta property="og:image:type" content="image/png"/>
	<meta property="og:image:alt" content="SEPIA Icon"/>
	<meta property="og:type" content="website"/>
	<meta property="og:locale" content="en_GB"/>
	<meta property="og:locale:alternate" content="en_US"/>
	
	<!--SCRIPTS / STYLES -->
	<link rel="stylesheet" href="css/code-ui.css">
	<link rel="stylesheet" href="lib/codemirror.css">
	<link rel="stylesheet" href="theme/sepia-fw.css">
	<script src="lib/codemirror.js"></script>
	<!--<script src="mode/javascript/javascript.js"></script>-->
	<script src="mode/clike/clike.js"></script>
	<script type="text/javascript" src="js/jquery-3.1.1.min.js" charset="UTF-8"></script>
	<script type="text/javascript" src="js/sjcl.js"  charset="UTF-8"></script>
	<script type="text/javascript" src="js/shared.js" charset="UTF-8"></script>
	<script type="text/javascript" src="js/authentication.js" charset="UTF-8"></script>
	
	<style>
	.CodeMirror {}
	</style>
</head>
<body>
<div id="main-view">
	<div id="header">
		<h3>SEPIA Code UI for Smart-Services</h3>
	</div>
	<div id="page">	
		<div id='upload-service-box'>
			<div class="block">
				<span class="group"><label>Server:</label><input id='server' type='text' spellcheck="false" value="http://localhost:20721/" placeholder="http://localhost:20721/"></span>
				<span class="group"><input id="id" type='text' form='upload-form' name='GUUID' spellcheck="false" placeholder="User-ID"></span>
				<span class="group"><input id="pwd" type='password' form='upload-form' name='PWD' placeholder="Password"></span>
			</div>
			<form id='upload-form' action='/upload-service' method='post' enctype='multipart/form-data' target='_blank' onsubmit="buildSubmitURL()">
				<div class="block">
					<button class='interface_button' type='submit'>UPLOAD SERVICE</button>
					<input type='file' name='upload_file' accept='.java,.sservice,.yaml'>
				</div>
			</form>
			<div><p>Source code:</p></div>
			<div class="block">
				<span class="group"><label>Class name: <input type='text' form='upload-form' name='upload_code_class_name' spellcheck="false"></label></span>
			</div>
			<div id="code-box-container">
				<textarea id='code-box' form='upload-form' name='upload_code'></textarea>
			</div>
		</div>
	</div>
	<div id="footer"><a href="https://github.com/SEPIA-Framework/sepia-sdk-java" target=_blank>SEPIA-SDK at GitHub</a></div>
</div>
<script>
	//load on document ready
	$(document).ready(function() {
		//call login
		login(function(data){
			//on success...
		});
		//restore session variables
		var id = sessionStorage.getItem('id');
		if (id){
			$('#id').val(id);
		}
		var pwd = sessionStorage.getItem('pwd');
		if (pwd){
			$('#pwd').val(pwd);
			updatePasswordSecurityWarning();
		}
		var customServer = sessionStorage.getItem('customServer');
		if (customServer){
			//stored server
			$('#server').val(customServer);
		}else{
			var serverViaUrl = getURLParameter('server');
			if (serverViaUrl){
				//URL parameter server
				$('#server').val(serverViaUrl);
			}else{
				if (location.host.indexOf(":") > 0){
					//local server [IP]:[PORT]
					$('#server').val(location.origin + "/");
				}
			}
		}
		var server = sessionStorage.getItem('server');
		if (server){
			server_select.value = server;
		}
		var customClient = sessionStorage.getItem('customClient');
		if (customClient){
			$('#custom-client').val(customClient);
		}
		//setup
		onReady();
	});

	//Setup CodeMirror
	function onReady(){
		//Initialize editor
		var codeContainer = document.getElementById('code-box-container');
		var javaEditor = CodeMirror.fromTextArea(document.getElementById("code-box"), {
			lineNumbers: true,
			matchBrackets: true,
			mode: "text/x-java",
			theme: "sepia-fw",
			dragDrop: true,
			allowDropFileTypes: ["text/x-java"]
		});
		javaEditor.setSize(codeContainer.offsetWidth, codeContainer.offsetHeight);
		javaEditor.setValue(document.getElementById('source-code').value);
		
		//Auto-resize editor
		var resizer = window.addEventListener('resize', function(){
			javaEditor.setSize(codeContainer.offsetWidth, codeContainer.offsetHeight);
		});
	}
	
	//Get submit URL
	function buildSubmitURL(){
		var server = document.getElementById("server").value;
		var uploadform = document.getElementById('upload-form');
		uploadform.action = server + 'upload-service' ;
		javaEditor.save();
	}
</script>
<textarea id="source-code" style="display:none;">package net.b07z.sepia.sdk.services.uid1007;

import java.util.TreeSet;

import org.json.simple.JSONObject;

import net.b07z.sepia.server.assist.data.Card;
import net.b07z.sepia.server.assist.data.Card.ElementType;
import net.b07z.sepia.server.assist.interpreters.NluResult;
import net.b07z.sepia.server.assist.services.ServiceBuilder;
import net.b07z.sepia.server.assist.services.ServiceInfo;
import net.b07z.sepia.server.assist.services.ServiceInterface;
import net.b07z.sepia.server.assist.services.ServiceResult;
import net.b07z.sepia.server.assist.services.ServiceInfo.Content;
import net.b07z.sepia.server.assist.services.ServiceInfo.Type;
import net.b07z.sepia.server.core.assistant.ACTIONS;
import net.b07z.sepia.server.core.data.Language;
import net.b07z.sepia.server.core.tools.JSON;
import net.b07z.sepia.server.core.tools.Sdk;

/**
 * "Hello World" custom service that just returns a "Hello" answer, 
 * a demo button that links to the SDK and a demo card that links to SEPIA website.
 * 
 * @author Florian Quirin
 *
 */
public class HelloWorld implements ServiceInterface{
	
	//Command name
	private static final String CMD_NAME = "hello_world";				//Name tag of your service (will be combined with userId to be unique)
	//Answers used:
	private static final String successAnswer = "chat_hello_0a"; 		//successful answer
	private static final String okAnswer = "default_not_possible_0a";	//service ran properly but can't generate desired result (e.g. a search term was not found)
	private static final String failAnswer = "error_0a";				//fallback if service or some part of it crashed
	
	//Define some sentences for testing:
	
	@Override
	public TreeSet<String> getSampleSentences(String lang){
		TreeSet<String> samples = new TreeSet<>();
		//GERMAN
		if (lang.equals(Language.DE.toValue())){
			samples.add("Hallo Welt!");
			
		//OTHER
		}else{
			samples.add("Hello world!");
		}
		return samples;
	}
	
	//Basic service setup:

	@Override
	public ServiceInfo getInfo(String language) {
		//Type of service (for descriptions, choose what you think fits best)
		ServiceInfo info = new ServiceInfo(Type.plain, Content.data, false);
		
		//Should be available publicly or only for the developer? Set this when you are done with testing and want to release
		//info.makePublic();
		
		//Command
		info.setIntendedCommand(Sdk.getMyCommandName(this, CMD_NAME));
		
		//Direct-match trigger sentences in different languages:
		String DE = Language.DE.toValue();
		info.addCustomTriggerSentence("Hallo Welt!", DE)
			.addCustomTriggerSentence("Hello world!", DE)
			.addCustomTriggerSentence("Teste meinen hallo Welt service.", DE);
		String EN = Language.EN.toValue();
		info.addCustomTriggerSentence("Hello world!", EN)
			.addCustomTriggerSentence("Test my hello world service.", EN);
		
		//Parameters:
		//This service has no parameters
		
		//Answers (these are the default answers, you can trigger a custom answer at any point in the module with api.setCustomAnswer(..)):
		info.addSuccessAnswer(successAnswer)
			.addFailAnswer(failAnswer)
			.addOkayAnswer(okAnswer);
		
		return info;
	}
	
	@Override
	public ServiceResult getResult(NluResult nluResult) {
		//initialize result
		ServiceBuilder api = new ServiceBuilder(nluResult, getInfo(nluResult.language));
		
		//get required parameters
		//NONE
		//get optional parameters
		//NONE
		
		//This service basically cannot fail ... ;-)
		
		//Just for demo purposes we add a button-action with a link to the SDK
		api.addAction(ACTIONS.BUTTON_IN_APP_BROWSER);
		api.putActionInfo("url", "https://github.com/SEPIA-Framework/sepia-sdk-java");
		api.putActionInfo("title", "SDK info");
		
		//... and we also add a demo card
		Card card = new Card(Card.TYPE_SINGLE);
		JSONObject linkCard = card.addElement(
				ElementType.link, 
				JSON.make("title", "S.E.P.I.A." + ":", "desc", "Hello World!"),
				null, null, "", 
				"https://sepia-framework.github.io/", 
				"https://sepia-framework.github.io/img/icon.png", 
				null, null
		);
		JSON.put(linkCard, "imageBackground", "#000");	//more options like CSS background
		api.addCard(card.getJSON());
		
		//all good
		api.setStatusSuccess();
		
		//build the API_Result
		ServiceResult result = api.buildResult();
		return result;
	}
}</textarea>
</body>
</html>
